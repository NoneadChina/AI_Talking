# AI Talking

AI Talking 是一个基于 Python 和 PyQt5 开发的多功能 AI 交互应用，支持多种 AI 模型和交互模式，包括聊天、讨论、辩论和批量处理等功能。

## 功能特性

### 🔹 聊天功能
- 支持与多种 AI 模型进行单轮和多轮对话
- 实时显示对话内容和模型响应
- 支持切换不同的 AI 服务提供商
- 支持修改、复制和删除聊天历史消息
- 提供富文本编辑功能，支持格式化文本

### 🔹 讨论功能
- 支持多 AI 模型之间的协作讨论
- 可以配置多个 AI 服务和模型参与讨论
- 实时显示讨论进程和结果
- 支持修改、复制和删除讨论历史消息
- 提供富文本编辑功能，支持格式化文本

### 🔹 辩论功能
- 支持设置正反方 AI 模型进行辩论
- 可配置辩论主题、规则和评判标准
- 实时显示辩论过程和结果
- 支持修改、复制和删除辩论历史消息
- 提供富文本编辑功能，支持格式化文本

### 🔹 批量处理功能
- 支持批量处理文本内容
- 可配置多个 AI 模型进行并行处理
- 支持处理结果的导出和管理

### 🔹 API 设置
- 支持配置多种 AI 服务提供商的 API 密钥
- 可设置默认模型和系统提示词
- 支持 API 请求参数的自定义配置

### 🔹 历史记录管理
- 自动保存所有对话和交互历史
- 支持历史记录的搜索、查看和删除
- 支持历史记录的导出和导入

### 🔹 自动更新
- 支持应用程序的自动检查更新
- 可配置更新频率和更新方式

## 技术栈

- **开发语言**: Python 3.12
- **GUI 框架**: PyQt5
- **AI 服务支持**: OpenAI、Google Gemini、Anthropic 等
- **配置管理**: python-dotenv
- **日志系统**: 自定义日志记录
- **自动更新**: 内置更新服务

## 安装说明

### 前置要求

- Python 3.10 或更高版本
- pip 包管理器

### 安装步骤

1. 克隆项目仓库
   ```bash
   git clone http://git.corp.nonead.com/tonyke/ai_talking.git
   cd ai_talking
   ```

2. 安装依赖包
   ```bash
   pip install -r requirements.txt
   ```

3. 配置环境变量
   - 复制 `.env.backup` 文件为 `.env`
   - 编辑 `.env` 文件，添加您的 AI 服务 API 密钥

4. 运行应用程序
   ```bash
   python src/main.py
   ```
   或使用批处理文件
   ```bash
   run_app.bat
   ```

## 使用方法

### 基本使用

1. **启动应用程序**
   - 双击 `run_app.bat` 文件或运行 `python src/main.py`

2. **配置 API 设置**
   - 点击 "设置" 标签页
   - 输入您的 AI 服务 API 密钥
   - 选择默认模型和系统提示词
   - 点击 "保存设置"

3. **开始聊天**
   - 点击 "聊天" 标签页
   - 输入您的问题或消息
   - 选择 AI 服务和模型
   - 点击 "发送" 按钮

4. **参与讨论**
   - 点击 "讨论" 标签页
   - 配置参与讨论的 AI 服务和模型
   - 输入讨论主题
   - 点击 "开始讨论"

5. **观看辩论**
   - 点击 "辩论" 标签页
   - 配置正反方 AI 模型
   - 输入辩论主题
   - 点击 "开始辩论"

6. **批量处理**
   - 点击 "批量" 标签页
   - 输入或导入需要处理的文本
   - 配置处理参数和模型
   - 点击 "开始处理"

### 高级功能

- **历史记录管理**
  - 点击 "历史" 标签页查看所有历史记录
  - 使用搜索功能查找特定对话
  - 可删除或导出历史记录

- **更新应用**
  - 应用启动时会自动检查更新
  - 也可以在 "关于" 标签页手动检查更新

## 项目结构

```
ai_talking/
├── releases/           # 版本发布目录
│   ├── v0.1.6/
│   │   └── RELEASE_NOTES.md
│   ├── v0.1.7/
│   │   └── RELEASE_NOTES.md
│   └── v0.1.8/
│       └── RELEASE_NOTES.md
├── resources/          # 资源文件目录
│   └── icon.ico        # 应用程序图标
├── scripts/            # 脚本文件目录
│   └── update_version.py  # 版本更新脚本
├── src/                # 主源代码目录
│   ├── ui/             # UI 组件目录
│   │   ├── batch/                 # 批量处理相关组件
│   │   │   ├── ai_config_panel.py
│   │   │   ├── config_panel.py
│   │   │   ├── controls_panel.py
│   │   │   └── results_panel.py
│   │   ├── debate/                # 辩论相关组件
│   │   │   ├── __init__.py
│   │   │   ├── ai_config_panel.py
│   │   │   ├── chat_history_panel.py
│   │   │   ├── config_panel.py
│   │   │   ├── controls_panel.py
│   │   │   └── debate_tab.py
│   │   ├── discussion/            # 讨论相关组件
│   │   │   ├── __init__.py
│   │   │   ├── ai_config_panel.py
│   │   │   ├── chat_history_panel.py
│   │   │   ├── config_panel.py
│   │   │   ├── controls_panel.py
│   │   │   └── discussion_tab.py
│   │   ├── about_tab.py             # 关于标签页
│   │   ├── api_settings.py          # API 设置
│   │   ├── batch_processing_tab.py  # 批量处理标签页
│   │   ├── chat_tab.py              # 聊天标签页
│   │   ├── debate_tab.py            # 辩论标签页
│   │   ├── discussion_tab.py        # 讨论标签页
│   │   ├── history_management_tab.py  # 历史记录管理标签页
│   │   └── ui_utils.py              # UI 工具函数
│   ├── utils/          # 工具类目录
│   │   ├── __init__.py
│   │   ├── ai_service.py            # AI 服务封装
│   │   ├── chat_history_manager.py  # 聊天历史管理
│   │   ├── error_monitor.py         # 错误监控
│   │   ├── logger_config.py         # 日志配置
│   │   ├── model_manager.py         # 模型管理
│   │   ├── thread_manager.py        # 线程管理
│   │   └── update_service.py        # 更新服务
│   └── main.py         # 主应用程序入口
├── tests/              # 测试文件目录
│   ├── __init__.py
│   ├── test_chat_history_manager.py
│   ├── test_error_monitor.py
│   ├── test_integration.py
│   └── test_thread_manager.py
├── .gitignore
├── ARCHITECTURE.md    # 架构设计文档
├── AUTO_UPDATE_README.md  # 自动更新说明
├── README.md          # 项目说明文档
├── requirements.txt   # 依赖包列表
└── run_app.bat        # 应用程序启动脚本
```

## 配置说明

### 环境变量配置

在 `.env` 文件中配置以下环境变量：

```env
# Ollama API 设置
OLLAMA_BASE_URL=http://localhost:11434

# OpenAI API 设置
OPENAI_API_KEY=your_openai_api_key

# DeepSeek API 设置
DEEPSEEK_API_KEY=your_deepseek_api_key

# 聊天系统提示词设置
CHAT_SYSTEM_PROMPT=请使用简体中文回答问题

# 讨论系统提示词设置
DISCUSSION_SYSTEM_PROMPT=你是一个参与讨论的AI助手。请根据收到的内容深入思考，并回应，多次回答时尽量从不同角度深入分析。使用第一性原理进行讨论，是一场高强度的智力合作与交锋。这不仅仅是普通的辩论或交流，而是试图共同逼近问题最根本的真相。
DISCUSSION_AI1_SYSTEM_PROMPT=思维层面-第一性原理的"引擎"，解构与还原能力，概念清晰化与定义能力，公理化思维与逻辑推理能力，批判性思维与溯因能力，系统思维与重建能力
DISCUSSION_AI2_SYSTEM_PROMPT=沟通与协作层面：第一性原理的"桥梁"，苏格拉底式提问术，主动倾听与精准复述，元沟通能力

# 辩论系统提示词设置
DEBATE_SYSTEM_PROMPT=你是一个辩论选手，请根据你的立场进行辩论，逻辑清晰，论点明确。能够梳理复杂问题，构建严密的论证链条，并能识别他人逻辑中的漏洞，快速搜集、筛选、消化和整合大量资料、数据、案例与理论，并将其转化为有力的论据。能够用清晰、简洁、有感染力的语言陈述观点，避免歧义。包括书面陈词和即兴口语。不仅要听对方"说了什么"，更要听出"没说什么"以及"逻辑断层在哪里"，并迅速组织语言进行回应。
DEBATE_AI1_PROMPT=你是正方辩手，构建一个完整、稳固、有吸引力的体系（己方立场）。建立并捍卫一个完整的论证体系。 "为什么这个观点是成立的？" 需要主动提供理由。给出一个有利于本方论证且公允、有说服力的定义，作为大厦的基石。论点之间要相互支撑，形成闭环。讲一个"好故事"。设立一个评判胜负的尺度（如"何者更有利于公平"），并证明己方完全符合。通过描绘美好愿景（采纳我方立场后的积极世界）来引发共鸣。归纳法（用多个例子证明规律）、演绎法（用公认原理推导个案）、价值升华。第一次回答不做回应反方质疑。
DEBATE_AI2_PROMPT=你是反方辩手，找出对方体系的裂缝并将其攻破，同时有机会也会树立自己的替代方案。质疑、挑战并试图瓦解正方的体系。证伪思维： "这个观点在什么地方不成立？" 需要主动寻找漏洞。指出正方定义的狭隘、不公或偏颇，并提出一个更合理或利于己方的替代定义。攻击对方最薄弱、最核心的环节（"擒贼先擒王"）。不必追求体系完整，但求攻击有效。质疑正方标准的合理性，或提出一个新的、更优的标准，并在新标准下证明己方优势。通过揭示风险、弊端（采纳正方立场后的消极后果）来引发警惕。归谬法（引申出荒谬结论）、举反例（一个反例足以动摇普遍结论）、数据质疑、切割论证（指出对方混淆了不同概念）。

# 专家AI3系统提示词
EXPERT_AI3_SYSTEM_PROMPT=角色设定，你是一位专业的学术讨论分析师，擅长从多轮对话中提取核心观点、梳理逻辑脉络，并形成结构清晰、立场中立的总结报告。核心任务，你的任务是对学者AI1与学者AI2的讨论历史进行专业总结。讨论主题为"{topic}"，总结原则，基于事实：严格依据对话文本，不添加未出现的信息。保持中立：平等呈现双方论点，避免倾向性语言。结构化呈现：按逻辑模块组织内容，突出关键分歧与共识。提炼洞察：识别讨论中的创新点、潜在假设或未解决的问题。输出结构：请按以下框架组织总结报告（使用Markdown格式）：一、讨论概览：主题界定：简要说明讨论的核心议题。讨论时长/轮次：如涉及。整体氛围：如辩论型、协作型等。二、核心论点梳理：学者AI1的主要立场与论据：关键论点1（附支持论据或案例）关键论点2（附支持论据或案例）学者AI2的主要立场与论据：关键论点1（附支持论据或案例）关键论点2（附支持论据或案例）三、关键分歧与共识：主要共识点：列出双方明确认同的观点。核心分歧点：对比双方立场差异最大的议题（可附原因分析）。未解决的争议：双方未能达成一致或需要进一步探讨的问题。四、讨论质量评估：逻辑严密性：是否存在论证漏洞或循环论证？论据充分性：是否引用数据、案例或理论支持？演进动态：讨论中是否有观点演进或妥协？五、潜在方向与建议：值得深入研究的子议题。可补充的外部知识或数据。对实际应用的启示（如适用）。

# 裁判AI3系统提示词
JUDGE_AI3_SYSTEM_PROMPT=角色与任务：你是一名专业的辩论裁判AI，负责对正方AI1与反方AI2的多轮辩论进行系统分析，辩论主题为"{topic}"。你的任务包括：分析总结双方的核心论点、论据与逻辑结构。对双方表现进行量化评分（0-100分），并分解得分构成。裁决最终胜利方，并详细说明胜利理由与失败原因。裁判执行流程：第一步：多轮论述分析：逐轮梳理双方论点，标注其逻辑链、证据强度与反驳效果。记录双方是否有效回应对方质疑，是否出现逻辑谬误或事实错误。评估论述的连贯性、深度与创新性。第二步：评分体系（满分100分）评分由以下维度构成：论证力（30分）论据的可靠性与相关性（10分）逻辑严谨性与反驳有效性（10分）论点深度与创新性（10分）结构性与清晰度（20分）论述层次与框架清晰度（10分）语言表达与重点突出（10分）说服力与针对性（30分）对对方弱点的攻击效果（10分）己方观点的防守稳固性（10分）整体说服力与听众导向（10分）事实与伦理基础（20分）事实准确性及数据支持（10分）论证的伦理合理性与价值观一致性（10分）第三步：胜负裁决标准：胜利方判定：综合评分更高的一方获胜。若分差＜5分，可基于"关键回合制胜"原则裁决（即某一轮中一方取得压倒性优势）。必须明确说明：胜利方的核心优势（如逻辑碾压、证据充分等）。失败方的关键短板（如逻辑漏洞、回避问题等）。输出格式要求：请严格按以下结构输出：【辩论总结】正方核心论点（简要列举）；反方核心论点（简要列举）；关键交锋点分析；【评分详情】正方AI1得分：XX/100论证力：X/30；结构性与清晰度：X/20；说服力与针对性：X/30；事实与伦理基础：X/20；反方AI2得分：XX/100；论证力：X/30；结构性与清晰度：X/20；说服力与针对性：X/30；事实与伦理基础：X/20；【最终裁决】胜利方：正方/反方；胜利理由：（结合评分维度具体说明）失败原因：（指出关键失误或不足）裁判原则：中立客观，避免偏好。关注逻辑而非情绪，重视证据而非修辞。对模糊或存疑的论述采取"不利推定"原则（即未充分证明则扣分）。
```

### 应用程序配置

在应用程序的 "设置" 标签页中可以配置：

- 默认 AI 服务提供商
- 默认 AI 模型
- 系统提示词
- API 请求参数
- 更新设置

## 开发指南

### 开发环境搭建

1. 克隆项目仓库
2. 安装依赖包
3. 配置开发环境变量
4. 运行开发版本
   ```bash
   python src/main.py
   ```

### 代码结构

- **UI 组件**: 位于 `src/ui/` 目录，每个标签页对应一个 Python 文件
- **工具类**: 位于 `src/utils/` 目录，提供各种服务和功能封装
- **主程序**: `src/main.py` 整合所有组件，启动应用程序

### 测试

运行测试用例：
```bash
pytest tests/
```

## 构建和发布

### 打包应用程序

使用 PyInstaller 打包应用程序：
```bash
pyinstaller AI_Talking.spec
```

### 生成安装程序

使用 Inno Setup 生成 Windows 安装程序：
```bash
ISCC AI_Talking_Setup.iss
```

## 贡献指南

1. Fork 项目仓库
2. 创建特性分支
   ```bash
   git checkout -b feature/your-feature
   ```
3. 提交更改
   ```bash
   git commit -m "Add your feature"
   ```
4. 推送分支
   ```bash
   git push origin feature/your-feature
   ```
5. 创建合并请求

## 许可证

本项目采用 MIT 许可证。详情请查看 LICENSE 文件。

## 联系信息

- 项目负责人: Tony Ke
- 公司: NONEAD Corporation
- 邮箱: tony.ke@nonead.com

## 版本历史

- v0.3.7 (2025-12-26): 讨论功能增强与国际化优化
  - 在讨论历史气泡中添加了"修改"按钮，按钮顺序调整为：修改、复制、删除
  - 实现了修改气泡内容的功能，支持自动保存
  - 修复了按钮功能失效问题，确保修改、复制、删除功能正常工作
  - 优化了所有国际化语言包（ar.json, de.json, es.json, fr.json, ko.json, ru.json）
  - 确保翻译准确、简洁，符合短语或短句形式
  - 以英文语言包为基准，保持翻译一致性

- v0.3.6 (2025-12-25): 国际化支持增强
  - 支持韩语、德语、西班牙语、法语、阿拉伯语和俄罗斯语
  - 修复讨论历史按钮功能
  - 修复语言切换问题
  - 确保状态信息随语言变化
  - 更新AI_Talking.spec文件，优化打包配置

- v0.3.5 (2025-12-24): 版本更新
  - 更新版本号从0.3.4到0.3.5

- v0.3.4 (2025-12-23): 功能优化
  - 优化聊天历史消息管理
  - 增强富文本编辑功能
  - 改进API设置界面

- v0.1.0 (2025-12-18): 初始版本发布
  - 实现聊天、讨论、辩论和批量处理功能
  - 支持多种 AI 服务提供商
  - 实现 API 设置和历史记录管理
  - 添加自动更新功能

## 未来计划

- [ ] 支持更多 AI 服务提供商
- [ ] 实现语音交互功能
- [ ] 添加更多 AI 交互模式
- [ ] 优化用户界面和用户体验
- [ ] 增强数据安全和隐私保护
- [ ] 支持更多语言和地区

---

**AI Talking** - 让 AI 交互更加智能、高效、有趣！